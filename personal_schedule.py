#!/usr/bin/env python3
"""
Personal Daily Schedule Notifier - Fixed Version with Full Wisdoms
"""

import asyncio
import aiohttp
from datetime import datetime
import logging
import random

# Configure logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

class PersonalScheduleNotifier:
    def __init__(self):
        # Telegram settings
        self.telegram_token = "8442392037:AAEiM_b4QfdFLqbmmc1PXNvA99yxmFVLEp8"
        self.chat_id = "350766421"

        # Schedule times (24-hour format, strictly for info, cron определяет время)
        self.schedule_times = {
            'morning': '07:30',
            'day': '12:30',
            'evening': '19:00'
        }

        # Полный список мудростей
        self.wisdoms = [
            # Раздел 1. Основные принципы и философия
            "New Day — New Opportunity.",
            "Ты — раб. Либо своих страхов, либо своей дисциплины.",
            "Бритва Оккама — экономия ресурсов помогает не тратить время и силы на маловероятные сценарии без весомых причин.",
            "Сосредоточься на том, что ты можешь изменить (мысли, действия), а не на внешнем.",
            "Принятие судьбы (Amor Fati): принимай всё, что происходит, как полезный урок.",
            "Управление эмоциями через разум: эмоции зависят от твоих суждений, а не от событий.",
            "Жизнь по добродетели: стремись к мудрости, справедливости, мужеству, умеренности.",
            "Жизнь в настоящем: сосредоточься на текущем моменте.",
            "Никто не судит тебя так строго, как ты сам. Отпусти это.",
            "Ты не отстаешь от друзей — ты строишь свой фундамент.",
            # Раздел 2. Наука, стоицизм и осознанность
            "«Никто не создал Вселенную, и никто не управляет ею… У нас есть один уникальный шанс — жизнь длиною в 2 миллиарда секунд». — Стивен Хокинг.",
            "«Каждый день — подарок Бога. Мне нужно жить насущным днём...» — Дмитрий Лихачёв.",
            "«Если бы Господь дал мне немного жизни, я бы ценил вещи не по их стоимости, а по их значимости». — Габриэль Гарсиа Маркес.",
            "Иван Сеченов: мозг — многопоточная система, фокус важнее мультизадачности.",
            "Приоритеты помогают сократить список дел и грамотно использовать время.",
            # Раздел 3. Эффективность, дисциплина и финансы
            "Энергия и действие: фокус на приоритетах.",
            "«Лучший способ взять жизнь под контроль — задавать себе вопрос: 'Зачем мне это надо?'».",
            "«Жизнь состоит из скучных, нудных и банальных вещей. Сделав которые, неожиданно получаешь то самое».",
            "«Денег нужно столько, чтобы о них не думать».",
            "Финансы — инструмент, а не цель.",
            "«Лучший способ провести жизнь — поставить себе большую, почти недостижимую цель и идти к ней всю жизнь».",
            "«Одна доминушка может уронить доминушку на 50% больше себя. Успех — цепочка правильных действий».",
            "Лучше сделать и пожалеть, чем не сделать и пожалеть.",
            "Дело не в том, как организовать задания, а в том, чтобы не делать ненужное и делать нужное.",
            "«Если бы мне пришлось дать один совет 20-летним — 'Никогда не пейте алкоголь'».",
            "«Алкоголь — как кредит: временно поднимает настроение, потом возвращаешь с процентами».",
            "«Хочешь быть выдающимся — держи здоровье и разум чистыми».",
            "Продуктивность — вещь индивидуальная; главное — собственная система.",
            # Раздел 4. Деньги и характер
            "Настоящее богатство — это возможность просыпаться без стресса.",
            "Деньги усиливают то, что уже есть внутри человека.",
            "Характер бесценен — трудности формируют личность.",
            "Богатство — не цель, а инструмент для свободы.",
            "Единственная игра, достойная того, чтобы в неё играть — это твоя собственная.",
            # Раздел 5. Осознание и философия жизни
            "Я — форма, которую на время приняла вечная энергия вселенной. (Лисёнок)",
            "Счастье — это отсутствие несчастья.",
            "Всем пофиг. Мир быстро забывает.",
            "Принятие смерти делает все проблемы несущественными.",
            "Все специалисты видят 'свой участок цепи'. Всю цепь не видит никто.",
            "Всё меняется — ценность в способности меняться.",
            "Опыт важнее связей, связи важнее денег.",
            "Люди меняются только под давлением обстоятельств.",
            "Секс, шорты и отсутствие диплома не мешают делать великое.",
            "Долгосрочный успех не бывает быстрым.",
            "Инстинкты — источник силы.",
            "В долгосрочной перспективе быть честным выгодно.",
            "Количество задач в дне должно стремиться к единице.",
            "Нет смысла никого прощать — просли не обижаться.",
            "Успех — это не альтернатива неудаче, а результат её преодоления.",
            "Чудеса случаются только с подготовленными.",
            "Мои права заканчиваются там, где начинаются чужие.",
            # Раздел 6. Бизнес, мышление и реальность
            "Возможности есть всегда и везде.",
            "Контроль — иллюзия. Сначала научись управлять собой.",
            "Люди не имеют ресурсов помочь тебе — надейся на себя.",
            "Лучший подарок детям — финансовая независимость родителей.",
            "Денег больше, чем людей, способных ими управлять.",
            "Опыт измеряется не годами, а событиями.",
            "Если нужен отпуск от работы — это не твоя работа.",
            "Если ты самый умный в комнате — ты не в той комнате.",
            "Делай просто и разумно — это труднее всего.",
            "Пенсии не будет. Гарантий не существует.",
            "Для больших изменений нужно много времени.",
            "Всё знание ограничено целями.",
            "Людям хочется верить, что кто-то знает, как жить. Таких нет.",
            "За любым великим достижением лежит самоотречение.",
            "Быть бедным — непрактично и стыдно.",
            "Если есть дефицит калорий — похудеешь. Sapienti sat.",
            # Раздел 7. Метафоры и жизненные истории
            "Притча 'Шарики, камешки, песок и 2 пива' — приоритеты жизни.",
            "Одна доминошная цепочка успеха — символ постоянного прогресса.",
            "SMART-цели: значимые, мотивирующие, амбициозные, ресурсные, тестируемые.",
            "Завещание Габриэля Гарсиа Маркеса — о любви, времени и благодарности."
        ]

        # Полное расписание
        self.schedule = { ... }  # Здесь вставляем твой оригинальный словарь self.schedule полностью (как в твоем коде)

    def get_random_wisdom(self):
        return random.choice(self.wisdoms)

    async def send_telegram_message(self, message: str):
        try:
            url = f"https://api.telegram.org/bot{self.telegram_token}/sendMessage"
            payload = {'chat_id': self.chat_id, 'text': message, 'parse_mode': 'HTML'}
            async with aiohttp.ClientSession() as session:
                async with session.post(url, json=payload, timeout=10) as response:
                    if response.status == 200:
                        return True
                    else:
                        text = await response.text()
                        logger.error(f"Ошибка Telegram: {text}")
                        return False
        except Exception as e:
            logger.error(f"Ошибка отправки в Telegram: {e}")
            return False

    async def send_message_for_period(self, period: str):
        date_str, day_of_week, schedule = self.get_today_schedule()
        if period == 'morning':
            message = self.format_morning_message(date_str, day_of_week, schedule)
        elif period == 'day':
            message = self.format_day_message(date_str, day_of_week, schedule)
        else:
            message = self.format_evening_message(date_str, day_of_week, schedule)
        return await self.send_telegram_message(message)

    # Остальные методы: format_morning_message, format_day_message, format_evening_message,
    # count_tasks, get_today_schedule — без изменений из предыдущей версии.

async def main(period: str):
    notifier = PersonalScheduleNotifier()
    await notifier.send_message_for_period(period)

if __name__ == "__main__":
    import sys
    if len(sys.argv) != 2 or sys.argv[1] not in ('morning', 'day', 'evening'):
        print("Использование: python notifier.py <morning|day|evening>")
        sys.exit(1)
    asyncio.run(main(sys.argv[1]))
